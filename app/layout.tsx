import "@/app/bootstrap.scss";
import { ClientRoot } from "./Root";

export const metadata = {
  title: "Next.js",
  description: "Generated by Next.js",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ja" suppressHydrationWarning>
      <body>
        <InitializeTheme />
        <ClientRoot>{children}</ClientRoot>
      </body>
    </html>
  );
}

function InitializeTheme() {
  // 参考 https://github.com/reactjs/react.dev/blob/main/src/pages/_document.tsx
  return (
    <script
      dangerouslySetInnerHTML={{
        __html: `
        (function (){
          function setTheme(newTheme){
            switch(newTheme){
              case 'light':
              case 'dark':
                document.documentElement.setAttribute('data-bs-theme', newTheme);
            }
          }
        
          var preferredTheme;
          try {
            preferredTheme = localStorage.getItem('theme');
          } catch(err) {}
        
          window.__setPreferredTheme = function(newTheme){
            preferredTheme = newTheme;
            setTheme(newTheme);
            try {
              localStorage.setItem('theme', newTheme);
            } catch(err) {}
          };
        
          var initialTheme = preferredTheme;
          var darkQuery = window.matchMedia('prefers-color-scheme: dark');
          if(!initialTheme){
            initialTheme = darkQuery.matches ? 'dark': 'light';
          }
          setTheme(initialTheme);

          darkQuery.addEventListener('change', function (e) {
            if(!preferredTheme){
              setTheme(e.matches ? 'dark' : 'light');
            }
          });
        })();
      `,
      }}
    />
  );
}
